<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Irisgram - Audio Visualizer</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/addons/p5.sound.js"></script>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background:#fffbeb; color:#78350f;
    line-height:1.6; padding:1rem;
}

.container {
    max-width:1600px; margin:0 auto; display:flex; flex-direction:column;
}

h1 {
    font-size:2rem; font-weight:900; text-transform:lowercase;
    text-align:center; margin-bottom:0.75rem; color:#78350f;
}

.main-layout {
    display:flex; gap:1.5rem; align-items:flex-start;
    justify-content:center; flex-wrap:nowrap;
}

.controls-panel {
    background:white; padding:1rem;
    border:2px solid #78350f; box-shadow:6px 6px 0 rgba(120,53,15,0.15);
    display:flex; flex-direction:column; gap:0.75rem;
    width:350px; /* wider panel for desktop */
    flex-shrink:0; overflow-y:auto; max-height:calc(100vh - 4rem);
}

.control-section { padding-bottom:1rem; border-bottom:2px solid #fef3c7; }
.control-section:last-child { border-bottom:none; padding-bottom:0; }

.control-section h3 {
    font-size:0.875rem; font-weight:900; text-transform:lowercase;
    color:#1d4ed8; margin-bottom:0.5rem;
}

.color-picker-group { margin-bottom:0.5rem; }
.color-picker-group:last-child { margin-bottom:0; }

label, .song-name { font-size:0.7rem; font-weight:600; color:#78350f; margin-bottom:0.3rem; display:block; text-transform:lowercase; text-align:center; }
.color-picker { width:100%; height:35px; border:2px solid #78350f; border-radius:4px; cursor:pointer; }

.btn {
    width:100%; padding:0.5rem 0.75rem; font-weight:700; text-transform:lowercase;
    border:2px solid #78350f; background:#2563eb; color:white;
    cursor:pointer; margin-bottom:0.4rem; font-size:0.8rem; transition:all 0.3s;
}
.btn:last-child { margin-bottom:0; }
.btn:hover { background:#1d4ed8; transform:translateY(-2px); }

.btn-secondary { background:white; color:#78350f; }
.btn-secondary:hover { background:#fef3c7; }

.btn-surprise { background:linear-gradient(135deg,#5C81F6 0%,#9B87F5 100%); border:2px solid #78350f; font-size:0.9rem; }
.btn-surprise:hover { transform:translateY(-2px) scale(1.02); }

.file-input-wrapper { position:relative; width:100%; overflow:hidden; display:inline-block; }
.file-input-wrapper input[type=file] { position:absolute; left:-9999px; }
.file-input-label {
    display:block; padding:0.5rem 0.75rem; font-weight:700; text-transform:lowercase;
    border:2px solid #78350f; background:white; color:#78350f; cursor:pointer; text-align:center;
    font-size:0.8rem; transition:all 0.3s;
}
.file-input-label:hover { background:#fef3c7; }

.song-name { margin-top:0.4rem; color:#92400e; }

.canvas-container {
    flex:1; display:flex; justify-content:center; align-items:center;
    padding:0.75rem; border:2px solid #78350f; box-shadow:6px 6px 0 rgba(120,53,15,0.15);
    aspect-ratio:1; max-width:650px; /* slightly bigger on desktop */
}

@media (max-width:768px){
    body { padding:0.5rem; }
    h1 { font-size:1.75rem; margin-bottom:0.5rem; }
    .main-layout { flex-direction:column; align-items:center; }
    .controls-panel { width:100%; max-height:none; }
    .canvas-container { width:100%; height:auto; padding:0.5rem; margin-top:1rem; }
}
</style>
</head>
<body>
<div class="container">
    <h1>irisgram</h1>
    <div class="main-layout">
        <div class="controls-panel">
            <div class="control-section">
                <h3>colors</h3>
                <div class="color-picker-group">
                    <label for="irisColor">iris color:</label>
                    <input type="color" id="irisColor" class="color-picker" value="#6ea6ff">
                </div>
                <div class="color-picker-group">
                    <label for="bgColor">background:</label>
                    <input type="color" id="bgColor" class="color-picker" value="#000000">
                </div>
            </div>
            <div class="control-section">
                <h3>upload song</h3>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept="audio/*">
                    <label for="fileInput" class="file-input-label">choose file</label>
                </div>
                <div class="song-name" id="songName">no song loaded</div>
            </div>
            <div class="control-section">
                <h3>default songs</h3>
                <button class="btn btn-surprise" onclick="surpriseMe()">âœ¨ surprise me!</button>
            </div>
            <div class="control-section">
                <h3>controls</h3>
                <button class="btn" id="playPauseBtn" onclick="handlePlayPause()">play</button>
                <button class="btn btn-secondary" onclick="resetSketch()">reset</button>
            </div>
            <div class="control-section">
                <h3>save</h3>
                <button class="btn btn-secondary" onclick="saveTransparent()">transparent</button>
                <button class="btn btn-secondary" onclick="saveBlack()">with background</button>
            </div>
        </div>
        <div class="canvas-container" id="canvasContainer"></div>
    </div>
</div>

<script>
let song, fft, angle=0, layer, isPlaying=false, isPaused=false, isFinished=false;
let irisColor={r:110,g:166,b:255}, bgColor={r:0,g:0,b:0};
const defaultSongs=[{name:"espresso",url:"espresso.mp3"},{name:"dandelion",url:"dandelion.mp3"},{name:"getup",url:"getup.mp3"},{name:"nights",url:"nights.mp3"}];

function setup(){
    let container=document.getElementById('canvasContainer');
    let size=Math.min(container.clientWidth,container.clientHeight);
    createCanvas(size,size).parent('canvasContainer');
    layer=createGraphics(width,height);
    fft=new p5.FFT(0,256);
    frameRate(60); loop(); getAudioContext().suspend();

    document.getElementById('irisColor').addEventListener('input',e=>{irisColor=hexToRgb(e.target.value); if(!isPlaying) redraw();});
    document.getElementById('bgColor').addEventListener('input',e=>{bgColor=hexToRgb(e.target.value); container.style.backgroundColor=e.target.value; if(!isPlaying) redraw();});
    document.getElementById('fileInput').addEventListener('change',handleFileSelect);
    container.style.backgroundColor='#000000';
}

function windowResized(){
    let container=document.getElementById('canvasContainer');
    let size=Math.min(container.clientWidth,container.clientHeight);
    resizeCanvas(size,size);
    layer=createGraphics(width,height);
    redraw();
}

function hexToRgb(hex){return {r:parseInt(hex.slice(1,3),16),g:parseInt(hex.slice(3,5),16),b:parseInt(hex.slice(5,7),16)};}
</script>
</body>
</html>
